{% extends 'base.html.twig' %}

{% block title %}Dashboard - Sportabzeichen{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('styles/results.css') }}">
    <link rel="stylesheet" href="{{ asset('css/sportabzeichen_my_results.css') }}">
{% endblock %}

{% block content %}
<div class="container py-4 public-wrapper">
    
    {# --- HEADER BEREICH --- #}
    <div class="d-flex justify-content-between align-items-start mb-4">
        <div>
            <h1 class="h2 mb-1 theme-heading">Willkommen zurück, {{ app.user.vorname|default('Sportler') }}!</h1>
            <p class="theme-muted mb-0">Hier ist deine aktuelle Übersicht.</p>
        </div>
        <div class="text-end">
             <span class="badge theme-bg-light theme-heading border theme-border p-2 fs-6 shadow-sm">Saison {{ current_year|default('2026') }}</span>
        </div>
    </div>

    <div class="row g-4">
        
        {# --- LETZTE PRÜFUNGSERGEBNISSE (Style aus results.html.twig) --- #}
        <div class="col-md-6">
            <div class="card h-100 shadow-sm theme-card theme-border border-0">
                <div class="card-header theme-bg-light theme-heading fw-bold border-bottom theme-border d-flex justify-content-between align-items-center py-3">
                    <span class="text-uppercase small tracking-wide">Letzte Abnahmen</span>
                    <span class="glyphicon glyphicon-star text-warning" aria-hidden="true"></span>
                </div>
                
                <div class="list-group list-group-flush">
                    {% for result in recent_results|default([]) %}
                        {# Medaillen-Klassen adaptiert von deinen Result-Badges #}
                        {% set mClass = 'theme-bg-light theme-muted' %}
                        {% if result.points == 3 %}{% set mClass = 'bg-gold-transparent' %}
                        {% elseif result.points == 2 %}{% set mClass = 'bg-silver-transparent' %}
                        {% elseif result.points == 1 %}{% set mClass = 'bg-bronze-transparent' %}
                        {% endif %}

                        <div class="list-group-item d-flex justify-content-between align-items-center theme-card theme-border p-3">
                            <div>
                                <h6 class="mb-1 theme-heading fw-bold">{{ result.discipline.name }}</h6>
                                <div class="small theme-muted">
                                    <span class="glyphicon glyphicon-calendar me-1" aria-hidden="true"></span> {{ result.date|date('d.m.Y') }}
                                </div>
                            </div>
                            
                            <div class="d-flex align-items-center gap-3">
                                {# Wert / Leistung #}
                                <div class="text-end">
                                    <div class="font-monospace fw-bold theme-heading fs-5 mb-0">
                                        {{ result.leistung }}
                                    </div>
                                    <div class="small theme-muted lh-1">{{ result.unit_label }}</div>
                                </div>
                                
                                {# Punkte Badge wie in results #}
                                <div class="result-badge-box {{ mClass }} border theme-border rounded text-center shadow-sm" style="min-width: 45px; padding: 4px;">
                                    <div class="badge-label-small text-uppercase opacity-75" style="font-size: 0.6rem;">Pkt</div>
                                    <div class="fw-bold theme-heading fs-6 lh-1">{{ result.points }}</div>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <div class="p-5 text-center theme-muted">
                            <span class="glyphicon glyphicon-list-alt mb-3 sa-icon-placeholder" style="font-size: 2em;" aria-hidden="true"></span>
                            <p class="mb-0">Noch keine offiziellen Ergebnisse in dieser Saison.</p>
                        </div>
                    {% endfor %}
                </div>
                
                <div class="card-footer theme-bg-light border-top theme-border text-center py-3">
                    <a href="{{ path('my_results') }}" class="btn btn-sm btn-outline-secondary theme-text w-100">
                        Alle Ergebnisse ansehen
                    </a>
                </div>
            </div>
        </div>

        {# --- AKTUELLES TRAINING (Style aus training.html.twig) --- #}
        <div class="col-md-6">
            <div class="card h-100 shadow-sm theme-card theme-border border-0">
                <div class="card-header theme-bg-light theme-heading fw-bold border-bottom theme-border d-flex justify-content-between align-items-center py-3">
                    <span class="text-uppercase small tracking-wide">Aktuelles Training</span>
                    <span class="glyphicon glyphicon-dashboard text-info" aria-hidden="true"></span>
                </div>
                
                <div class="list-group list-group-flush">
                    {% for train in recent_trainings|default([]) %}
                        <a href="{{ path('training_detail', {'id': train.discipline.id}) }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center theme-card theme-border p-3">
                            <div>
                                <h6 class="mb-1 theme-heading fw-bold">{{ train.discipline.name }}</h6>
                                {% if train.next_goal_label %}
                                    <div class="small theme-muted">Nächstes Ziel: <strong class="theme-heading">{{ train.next_goal_label }}</strong></div>
                                {% else %}
                                    <div class="small text-success"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Gold-Niveau erreicht</div>
                                {% endif %}
                            </div>
                            
                            <div class="text-end">
                                <div class="font-monospace fw-bold theme-heading fs-5 mb-0">
                                    {{ train.value }} <span class="fs-6 theme-muted fw-normal font-sans-serif">{{ train.unit_label }}</span>
                                </div>
                                <div class="small theme-muted sa-text-xs">
                                    {{ train.created_at|date('d.m.') }} | {{ train.created_at|date('H:i') }} Uhr
                                </div>
                            </div>
                        </a>
                    {% else %}
                        <div class="p-5 text-center theme-muted">
                            <span class="glyphicon glyphicon-stats mb-3 sa-icon-placeholder" style="font-size: 2em;" aria-hidden="true"></span>
                            <p class="mb-0">Aktuell keine Trainingsdaten hinterlegt.<br>Starte jetzt!</p>
                        </div>
                    {% endfor %}
                </div>
                
                <div class="card-footer theme-bg-light border-top theme-border text-center py-3">
                    <a href="{{ path('training_overview') }}" class="btn btn-sm btn-primary shadow-sm w-100">
                        <span class="glyphicon glyphicon-plus me-1" aria-hidden="true"></span> Neues Training erfassen
                    </a>
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock %}