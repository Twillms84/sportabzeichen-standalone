{% extends 'base.html.twig' %}

{% block title %}Mein Sportabzeichen {{ year }}{% endblock %}

{% block body %}
{% set unitMap = {
    'UNIT_METERS': 'm', 'UNIT_CENTIMETERS': 'cm', 'UNIT_SECONDS': 'Sek.', 
    'UNIT_MINUTES': 'Min.', 'UNIT_HOURS': 'Std.', 'UNIT_NUMBER': 'Anz.', 
    'UNIT_PIECES': 'Wert', 'NONE': 'Verband', 'UNIT_NONE': 'Verband'
} %}

<div class="container py-4">
    <header class="mb-5 text-center">
        <h1 class="display-5 fw-bold text-primary">Mein Sportabzeichen {{ year }}</h1>
        <p class="lead text-muted">Deine sportlichen Ziele im Überblick (Alter: {{ age }} Jahre)</p>
        <hr class="short-hr">
    </header>

    {% for catName, disciplines in categories %}
        {% if disciplines is not empty %}
            <div class="category-section mb-5">
                <h3 class="h4 mb-4 d-flex align-items-center">
                    <span class="badge bg-primary me-2">{{ loop.index }}</span>
                    {{ catName }}
                </h3>
                
                <div class="row g-3">
                    {% for row in disciplines %}
                        {% set einheit_label = unitMap[row.einheit]|default(row.einheit) %}
                        <div class="col-md-6 col-lg-4">
                            <div class="card h-100 shadow-sm border-0 hover-lift">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <h5 class="card-title fw-bold mb-0">{{ row.name }}</h5>
                                        <span class="badge bg-light text-dark border">{{ einheit_label }}</span>
                                    </div>

                                    <div class="d-flex justify-content-between small text-center my-3 bg-light rounded p-2">
                                        <div class="px-2">
                                            <div class="text-muted small">Bronze</div>
                                            <div class="fw-bold" style="color: #cd7f32;">{{ row.bronze }}</div>
                                        </div>
                                        <div class="px-2 border-start border-end">
                                            <div class="text-muted small">Silber</div>
                                            <div class="fw-bold text-secondary">{{ row.silber }}</div>
                                        </div>
                                        <div class="px-2">
                                            <div class="text-muted small">Gold</div>
                                            <div class="fw-bold" style="color: #d4af37;">{{ row.gold }}</div>
                                        </div>
                                    </div>

                                    <div class="official-result-box mb-3 p-2 border rounded text-center">
                                        <div class="small text-muted uppercase">Offizielles Ergebnis</div>
                                        {% if row.official_result %}
                                            <div class="h4 mb-0 fw-bold">{{ row.official_result.leistung }}</div>
                                            {% if row.official_result.points == 3 %}
                                                <span class="text-warning small"><i class="fas fa-medal"></i> Gold erreicht</span>
                                            {% elseif row.official_result.points == 2 %}
                                                <span class="text-secondary small"><i class="fas fa-medal"></i> Silber erreicht</span>
                                            {% elseif row.official_result.points == 1 %}
                                                <span class="text-bronze small"><i class="fas fa-medal"></i> Bronze erreicht</span>
                                            {% endif %}
                                        {% else %}
                                            <div class="text-muted fst-italic">Noch keine Prüfung</div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="card-footer bg-transparent border-0 pb-3">
                                    <a href="{{ path('training_detail', { disciplineId: row.discipline_id }) }}" 
                                       class="btn btn-outline-primary w-100 d-flex justify-content-between align-items-center">
                                        <span><i class="fas fa-running me-2"></i> Training</span>
                                        <span class="fw-bold">{{ row.training_value|default('Starten') }}</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endif %}
    {% endfor %}
</div>

<style>
    .hover-lift { transition: transform 0.2s ease, shadow 0.2s ease; }
    .hover-lift:hover { transform: translateY(-4px); box-shadow: 0 1rem 3rem rgba(0,0,0,.175)!important; }
    .text-bronze { color: #cd7f32; }
    .short-hr { width: 50px; border-top: 3px solid var(--bs-primary); margin: 1rem auto; opacity: 1; }
    .category-section h3 { border-bottom: 2px solid #eee; padding-bottom: 10px; }
</style>
{% endblock %}