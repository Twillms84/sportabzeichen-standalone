/*! For license information please see exam_results_autosave.794a905e.js.LICENSE.txt */
(()=>{function e(){var r,n,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function s(e,a,i,o){var s=a&&a.prototype instanceof l?a:l,u=Object.create(s.prototype);return t(u,"_invoke",function(e,t,a){var i,o,s,l=0,u=a||[],d=!1,f={p:0,n:0,v:r,a:m,f:m.bind(r,4),d:function(e,t){return i=e,o=0,s=r,f.n=t,c}};function m(e,t){for(o=e,s=t,n=0;!d&&l&&!a&&n<u.length;n++){var a,i=u[n],m=f.p,g=i[2];e>3?(a=g===t)&&(s=i[(o=i[4])?5:(o=3,3)],i[4]=i[5]=r):i[0]<=m&&((a=e<2&&m<i[1])?(o=0,f.v=t,f.n=i[1]):m<g&&(a=e<3||i[0]>t||t>g)&&(i[4]=e,i[5]=t,f.n=g,o=0))}if(a||e>1)return c;throw d=!0,t}return function(a,u,g){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,g),o=u,s=g;(n=o<2?r:s)||!d;){i||(o?o<3?(o>1&&(f.n=-1),m(o,s)):f.n=s:f.v=s);try{if(l=2,i){if(o||(a="next"),n=i[a]){if(!(n=n.call(i,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,o<2&&(o=0)}else 1===o&&(n=i.return)&&n.call(i),o<2&&(s=TypeError("The iterator does not provide a '"+a+"' method"),o=1);i=r}else if((n=(d=f.n<0)?s:e.call(t,f))!==c)break}catch(e){i=r,o=1,s=e}finally{l=1}}return{value:n,done:d}}}(e,i,o),!0),u}var c={};function l(){}function u(){}function d(){}n=Object.getPrototypeOf;var f=[][i]?n(n([][i]())):(t(n={},i,function(){return this}),n),m=d.prototype=l.prototype=Object.create(f);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,t(e,o,"GeneratorFunction")),e.prototype=Object.create(m),e}return u.prototype=d,t(m,"constructor",d),t(d,"constructor",u),u.displayName="GeneratorFunction",t(d,o,"GeneratorFunction"),t(m),t(m,o,"Generator"),t(m,i,function(){return this}),t(m,"toString",function(){return"[object Generator]"}),(e=function(){return{w:s,m:g}})()}function t(e,r,n,a){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}t=function(e,r,n,a){function o(r,n){t(e,r,function(e){return this._invoke(r,n,e)})}r?i?i(e,r,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[r]=n:(o("next",0),o("throw",1),o("return",2))},t(e,r,n,a)}function r(e,t,r,n,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,a)}function n(e){return function(){var t=this,n=arguments;return new Promise(function(a,i){var o=e.apply(t,n);function s(e){r(o,a,i,s,c,"next",e)}function c(e){r(o,a,i,s,c,"throw",e)}s(void 0)})}}document.addEventListener("DOMContentLoaded",function(){var t=jQuery,r=t("#viewSelector");if(r.length){r.on("changed.bs.select",function(e,r,n,a){var i=t(this).val()||[];t("#viewSelector option").each(function(){var e=t(this).val(),r=document.querySelectorAll(".col-cat-"+e);0===i.length||i.includes(e)?r.forEach(function(e){return e.classList.remove("col-hidden")}):r.forEach(function(e){return e.classList.add("col-hidden")})}),localStorage.setItem("sportabzeichen_view_selection",JSON.stringify(i))});var a=localStorage.getItem("sportabzeichen_view_selection");if(a)try{var i=JSON.parse(a);i&&i.length>0&&r.selectpicker("val",i),r.selectpicker("refresh"),r.trigger("changed.bs.select")}catch(e){console.error("Storage Error",e)}}var o=t("#client-class-filter"),s=document.getElementById("client-search-input");if(o.length&&s){var c=document.querySelectorAll(".participant-row"),l=new Set;c.forEach(function(e){var t=e.getAttribute("data-class")||e.getAttribute("data-group");if(t){var r=t.trim();""!==r&&l.add(r)}}),Array.from(l).sort().forEach(function(e){o.append('<option value="'.concat(e,'">').concat(e,"</option>"))}),t.fn.selectpicker&&o.selectpicker("refresh");var u=function(){var e=o.val();e?Array.isArray(e)||(e=[e]):e=[];var r=s.value.toLowerCase().trim();document.querySelectorAll(".participant-row").forEach(function(t){var n=(t.getAttribute("data-class")||t.getAttribute("data-group")||"").trim(),a=t.querySelector(".name-main"),i=a?a.textContent.toLowerCase():"",o=0===e.length||e.includes(n),s=""===r||i.includes(r);t.style.display=o&&s?"":"none"});var n=t("#btn-print-groupcard");if(n.length){n.data("base-href")||n.data("base-href",n.attr("href"));var a=n.data("base-href"),i=Array.isArray(e)&&e.length>0?e[0]:"",c=s.value.trim(),l=a.includes("?")?"&":"?",u=a+l+"class_filter="+encodeURIComponent(i);c&&(u+="&search_query="+encodeURIComponent(c)),n.attr("href",u)}};o.on("change changed.bs.select",u),s.addEventListener("keyup",u),s.addEventListener("input",u)}var d=document.getElementById("autosave-form");if(d){var f=d.getAttribute("data-discipline-route"),m=d.getAttribute("data-result-route"),g=d.getAttribute("data-swimming-route"),b=d.getAttribute("data-swimming-delete-route"),v=d.getAttribute("data-global-token");document.querySelectorAll(".js-discipline-select").forEach(function(e){L(e),w(e)}),d.addEventListener("change",function(){var t=n(e().m(function t(r){var n,a,i,o,s,c,l,u,d,b,h,y,A;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if((n=r.target).hasAttribute("data-save")){e.n=1;break}return e.a(2);case 1:if(a=n.getAttribute("data-ep-id"),i=n.getAttribute("data-type"),o=n.getAttribute("data-kategorie"),s=n.closest("td"),c=n.closest("tr"),l="",u={ep_id:a,_token:v},d=s?s.querySelector("select"):null,b=s?s.querySelector('input[type="text"]'):null,"swimming_select"!==i){e.n=2;break}l=g,u.discipline_id=n.value,e.n=4;break;case 2:if(d&&d.value&&a){e.n=3;break}return e.a(2);case 3:l="SELECT"===n.tagName?f:m,"SELECT"===n.tagName&&(L(n),w(n)),u.discipline_id=d.value,u.leistung=b?b.value:"",b&&!b.disabled&&"leistung"===i&&(b.setAttribute("data-temp-disabled","true"),b.disabled=!0,b.style.opacity="0.6");case 4:return e.p=4,e.n=5,fetch(l,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(u)});case 5:return h=e.v,e.n=6,h.json();case 6:if(y=e.v,b&&b.hasAttribute("data-temp-disabled")&&(b.disabled=!1,b.removeAttribute("data-temp-disabled"),b.style.opacity="1",b.focus()),"ok"!==y.status&&!y.success){e.n=7;break}try{"swimming_select"!==i&&s&&(E(y,s,c,o,n),y.new_requirements&&S(s,y.new_requirements)),p(a,0,y)}catch(e){console.error("UI Update Warning:",e)}e.n=8;break;case 7:throw new Error(y.message||"Fehler beim Speichern");case 8:e.n=10;break;case 9:e.p=9,A=e.v,console.error("Save Error:",A),b&&(b.disabled=!1,b.classList.add("bg-danger","bg-opacity-25"),setTimeout(function(){return b.classList.remove("bg-danger","bg-opacity-25")},3e3));case 10:return e.a(2)}},t,null,[[4,9]])}));return function(e){return t.apply(this,arguments)}}()),document.addEventListener("click",function(){var t=n(e().m(function t(r){var n,a,i,o,s,c,l,u,d,f,m,g,h,y,S;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=r.target.closest(".btn-delete-swimming")){e.n=1;break}return e.a(2);case 1:if(r.preventDefault(),a=n.getAttribute("data-ep-id"),i=String(n.getAttribute("data-year")||""),o=String(n.getAttribute("data-current-year")||""),s=n.getAttribute("data-source")||"",c=s.toUpperCase(),!i||!o||i===o){e.n=2;break}return alert("Jahr ".concat(i," kann hier nicht gelöscht werden.")),e.a(2);case 2:if(!["AUSDAUER","SCHNELLIGKEIT","ENDURANCE","SPEED"].some(function(e){return c.includes(e)})){e.n=3;break}return alert('Automatisch durch "'.concat(s,'" erbracht. Bitte dort löschen.')),e.a(2);case 3:if(confirm("Wirklich löschen?")){e.n=4;break}return e.a(2);case 4:return l=n.innerHTML,n.style.opacity="0.5",n.disabled=!0,e.p=5,e.n=6,fetch(b,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({ep_id:a,_token:v})});case 6:return u=e.v,e.n=7,u.json();case 7:if("ok"===(d=e.v).status||!0===d.success)try{n.closest("tr"),p(a,0,d),(f=document.getElementById("swimming-wrapper-"+a))&&(m=f.querySelector(".swim-badge-container"),g=f.querySelector(".swim-dropdown-container"),m&&m.classList.add("d-none"),g&&g.classList.remove("d-none"),(h=f.querySelector("select"))&&(h.value=""),(y=f.querySelector(".swim-info-text"))&&(y.textContent=""))}catch(e){console.error("Löschen UI Update Error:",e)}else alert("Fehler: "+(d.message||"Fehler beim Löschen."));e.n=9;break;case 8:e.p=8,S=e.v,console.error("Delete Request Error:",S),alert("Kommunikationsfehler: Der Server konnte nicht erreicht werden.");case 9:return e.p=9,n&&(n.style.opacity="1",n.disabled=!1,n.innerHTML=l),e.f(9);case 10:return e.a(2)}},t,null,[[5,8,9,10]])}));return function(e){return t.apply(this,arguments)}}())}function p(e,t,r){var n=void 0!==r.total?r.total:r.total_points,a=document.getElementById("total-points-"+e);a&&void 0!==n&&(a.textContent=n,h(a));var i=document.getElementById("final-medal-"+e),o=r.final_medal||r.medal||"none";if(o=String(o).toLowerCase(),i){var s=i.querySelector(".js-medal-label");i.className="result-badge-box";var c="-",l="bg-light text-muted";switch(o){case"gold":l="medal-gold",c="Gold";break;case"silver":case"silber":l="medal-silber",c="Silber";break;case"bronze":l="medal-bronze",c="Bronze";break;default:l="",c="-"}l&&i.classList.add(l),s?s.textContent=c:i.textContent=c,h(i)}var u=!0===r.has_swimming||1===r.has_swimming||"1"===String(r.has_swimming),d=document.getElementById("swimming-wrapper-"+e);if(d){var f=d.querySelector(".swim-badge-container"),m=d.querySelector(".swim-dropdown-container"),g=d.querySelector(".swim-info-text");if(u){if(g){var b="";if(r.swimming_name&&!String(r.swimming_name).includes("DISCIPLINE")&&(b=r.swimming_name),!b){var v=d.querySelector("select");if(v&&v.selectedIndex>-1){var p=v.options[v.selectedIndex];p.value&&(b=p.text)}}b||(b="Nachweis erbracht"),g.textContent=b}f&&f.classList.remove("d-none"),m&&m.classList.add("d-none")}else{f&&f.classList.add("d-none"),m&&m.classList.remove("d-none"),g&&(g.textContent="");var y=d.querySelector("select");y&&(y.value="")}}}function h(e){e&&(e.style.transition="transform 0.2s ease-in-out",e.style.transform="scale(1.1)",setTimeout(function(){return e.style.transform="scale(1)"},200))}function y(e){e.classList.remove("medal-gold","medal-silber","medal-bronze","medal-none")}function S(e,t){var r=e.querySelector(".req-val-b"),n=e.querySelector(".req-val-s"),a=e.querySelector(".req-val-g");r&&(r.textContent=t.bronze),n&&(n.textContent=t.silber),a&&(a.textContent=t.gold)}function w(e){var t=e.closest("td").querySelector('input[type="text"]');if(t){var r=e.options[e.selectedIndex];if(!r||!r.value)return t.disabled=!0,t.value="",y(t),void y(e);var n=r.getAttribute("data-unit"),a=parseInt(r.getAttribute("data-implicit-points")||0);"NONE"===n||"UNIT_NONE"===n||a>0?(t.value="",t.setAttribute("placeholder","✓"),t.disabled=!0,t.classList.add("bg-light"),y(t),y(e),t.classList.add("medal-gold"),e.classList.add("medal-gold")):(t.disabled=!1,t.setAttribute("placeholder",""),t.classList.remove("bg-light"),""===t.value&&(y(t),y(e),t.classList.add("medal-none"),e.classList.add("medal-none")))}}function E(e,t,r,n,a){var i=t.querySelector("select"),o=t.querySelector('input[type="text"]'),s="SELECT"===a.tagName,c=e.stufe?e.stufe.toLowerCase():"none",l="medal-"+c;"silver"===c&&(l="medal-silber"),[i,o].forEach(function(e){e&&(y(e),e.classList.add(l))}),"NONE"===e.discipline_unit||"UNIT_NONE"===e.discipline_unit?(o&&(o.value="",o.disabled=!0,o.setAttribute("placeholder","✓"),o.classList.add("bg-light"),y(o),o.classList.add("medal-gold")),i&&(y(i),i.classList.add("medal-gold"))):s&&w(i),s&&n&&r.querySelectorAll('[data-kategorie="'.concat(n,'"]')).forEach(function(e){e.closest("td")!==t&&("INPUT"===e.tagName&&(e.value="",e.disabled=!0,e.classList.remove("bg-light"),y(e),e.classList.add("medal-none")),"SELECT"===e.tagName&&(e.value="",y(e),e.classList.add("medal-none"),L(e)))})}function L(e){var t=e.closest("td");if(t){var r=e.options[e.selectedIndex],n={b:t.querySelector(".req-val-b"),s:t.querySelector(".req-val-s"),g:t.querySelector(".req-val-g"),unit:t.querySelector(".req-unit")},a=t.querySelector('input[data-type="leistung"]');if(!r||!r.value)return Object.values(n).forEach(function(e){return e&&(e.textContent="")}),void(a&&(a.disabled=!0));var i=r.getAttribute("data-unit-label")||"",o=parseInt(r.getAttribute("data-implicit-points")||0),s=r.getAttribute("data-unit");"NONE"===s||"UNIT_NONE"===s||o>0?Object.values(n).forEach(function(e){return e&&(e.textContent="")}):(n.b&&(n.b.textContent=r.getAttribute("data-bronze")||"-"),n.s&&(n.s.textContent=r.getAttribute("data-silber")||"-"),n.g&&(n.g.textContent=r.getAttribute("data-gold")||"-"),n.unit&&(n.unit.textContent=i))}}})})();